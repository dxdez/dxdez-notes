---
title: "Adding an Existing Laravel Sail Project on to a VM"
date: 2024-02-08T16:46:21-05:00
draft: true
---

These are some of the steps used to cloning a laravel sail project from a git repository on to a virtual machine for testing purposes. This exercise is good for testing server production for a project.

### Setting up a Linux enviornment

For this project, we are using Rocky Linux. The minimal install is reccomended. Once the installation is complete there are some tools that are needed; these include the following: git, docker + docker, compose

To install git run the following command:
`````
sudo dnf install git
`````

To install docker on Rocky linux, run the following commands to add the repo and then run the installer:
`````
sudo dnf config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
sudo dnf -y install docker-ce docker-ce-cli containerd.io docker-compose-plugin
sudo systemctl --now enable docker
`````

Once Docker is installed, it is important to establish a non-root user into the Docker group to avoid running docker with the `sudo` prefix; this can avoid complications later. To add a non root user to the group follow the below commands:
`````
sudo groupadd docker
sudo usermod -aG docker $USER
newgrp docker
`````

You can verify that this worked by running a general docker command like: `docker --version` without the super user prefix.


### Cloning the Project

Once the docker enviornment is setup, you can now clone the desired project. 

Using git, run the following command in the desired project folder:
`````
https://github.com/{username}/{repository}.git
`````

Replace username with the owner of the repository and replace the repository keyword with the actual project name. You can then navigate into the folder:
`````
cd {repository-name}
`````

## Setting up a .env file

By default, a typical project won't include its .env file for security reasons. For your local enviornment you can copy the .env.example file into a .env file which will connect the endpoints such as the `DB_NAME/DB_HOST` to your application.

A quick way to do this is run the command from within the app folder:
`````
cp .env.example .env
`````

### Pull the Dependencies to Run Sail

You may install the application's dependencies by navigating to the application's directory and executing the following command. This command uses a small Docker container containing PHP and Composer to install the application's dependencies:
`````bash
docker run --rm \
    -u "$(id -u):$(id -g)" \
    -v "$(pwd):/var/www/html" \
    -w /var/www/html \
    laravelsail/php83-composer:latest \
    composer install --ignore-platform-reqs
`````
Note, you will need to replace php83 with the version that is found within the docker-compose file. For example, if the version is `php-8.2` then you will need to use `php82-composer:latest`

#### Setting an Alias

To avoid retypping the vendor path for each execution, an alias is reccomended for running sail commands. This can be done like so:
`````
alias sail='[ -f sail ] && sh sail || sh vendor/bin/sail'
`````

### Adding a Firewall Exception
By default, your firewall will likely block port 80/8080/8000 which will prevent your application from displaying when accessing the ip externally. A workaround is to add an exception. Save the following into a bash script file like `execute.sh` and then run.

You can replace the service name with whatever you prefer:
`````
YOURPORT=8080
PERM="--permanent"
SERV="$PERM --service=laravel"

firewall-cmd $PERM --new-service=laravel
firewall-cmd $SERV --set-short="Laravel ports"
firewall-cmd $SERV --set-description="Laravel port exceptions"
firewall-cmd $SERV --add-port=$YOURPORT/tcp
firewall-cmd $PERM --add-service=laravel
firewall-cmd --zone=public --add-service=http --permanent
firewall-cmd --reload
`````


